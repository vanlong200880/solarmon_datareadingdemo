'use strict';

/**
 * http://usejsdoc.org/
 */
var redis = require("redis");
var RedisProvider = function RedisProvider() {};
RedisProvider.init = function (config) {
	var client = redis.createClient(config);
	this.client = client;
	client.on('connect', function () {
		console.log('connected');
	});
	client.on("error", function (err) {
		console.log("Error " + err);
	});
	// this.client.get('staff_1', function(err, reply) {
	// 	if (err) {
	// 		console.log(err);
	// 		throw err;
	// 	}
	// 	console.log('GET result ->' + reply);
	// });	
};
/**
 * @param 
 * objE: entity
 * alias: tên alias của entity
 * tên property khóa chính objE
 * array property index  
 */
RedisProvider.set = function (objE, alias, primaryKey, indexKeys, callback) {
	var key = this.generateKey(objE, alias, primaryKey);
	var idxKeys = this.generateIdxKeys(objE, alias, primaryKey, indexKeys);
	for (var idxKey in idxKeys) {
		this.client.sadd(idxKey, idxKeys[idxKey]);
	}
	this.client.hmset(key, objE, function (err, reply) {
		if (typeof callback === 'function') {
			callback(err, reply);
		}
	});
};
RedisProvider.del = function (objE, alias, primaryKey, indexKeys, callback) {
	var key = this.generateKey(objE, alias, primaryKey);
	var idxKeys = this.generateIdxKeys(objE, alias, primaryKey, indexKeys);
	for (var idxKey in idxKeys) {
		this.client.srem(idxKey, idxKeys[idxKey]);
	}
	this.client.del(key, function (err, reply) {
		if (typeof callback === 'function') {
			callback(err, reply);
		}
	});
};
RedisProvider.lPush = function (key, value, callback) {
	this.client.lpush(key, value, function (err, reply) {
		if (typeof callback === 'function') {
			callback(err, reply);
		}
	});
};
RedisProvider.rPop = function (key, callback) {
	this.client.rpop(key, function (err, reply) {
		if (typeof callback === 'function') {
			callback(err, reply);
		}
	});
};
RedisProvider.zadd = function (key, score, value, callback) {
	this.client.zadd(key, score, value, function (err, reply) {
		if (typeof callback === 'function') {
			callback(err, reply);
		}
	});
};
RedisProvider.zrem = function (key, value, callback) {
	this.client.zrem(key, value, function (err, reply) {
		if (typeof callback === 'Function') {
			callback(err, reply);
		}
	});
};
RedisProvider.setSingle = function (key, value) {
	this.client.set(key, value, redis.print);
};
RedisProvider.getSingle = function (key) {
	this.client.get(key, function (err, reply) {
		if (err) {
			console.log(err);
			throw err;
		}
		console.log('GET result ->' + reply);
	});
};

RedisProvider.delSingle = function (key) {
	this.client.del(key);
};

RedisProvider.generateKey = function (objE, alias, primaryKey) {
	try {
		return alias + "_" + primaryKey + ":" + objE[primaryKey];
	} catch (e) {
		// TODO: handle exception
		redisLog.error(e);
		return "";
	}
};
RedisProvider.generateIdxKeys = function (objE, alias, primaryKey, indexKeys) {
	var idxKeys = {};
	for (var index in indexKeys) {
		try {
			var idxKey = "IX_" + alias + "_" + indexKeys[index] + ":" + objE[indexKeys[index]];
			idxKeys[idxKey] = alias + "_" + primaryKey + ":" + objE[primaryKey];
			console.log(idxKey);
		} catch (e) {
			// TODO: handle exception
			redisLog.error(e);
		}
	}
	return idxKeys;
};
module.exports = RedisProvider;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uLy4uL3NyYy9EQk1hbmFnZXJzL1JlZGlzL1JlZGlzUHJvdmlkZXIuanMiXSwibmFtZXMiOlsicmVkaXMiLCJyZXF1aXJlIiwiUmVkaXNQcm92aWRlciIsImluaXQiLCJjb25maWciLCJjbGllbnQiLCJjcmVhdGVDbGllbnQiLCJvbiIsImNvbnNvbGUiLCJsb2ciLCJlcnIiLCJzZXQiLCJvYmpFIiwiYWxpYXMiLCJwcmltYXJ5S2V5IiwiaW5kZXhLZXlzIiwiY2FsbGJhY2siLCJrZXkiLCJnZW5lcmF0ZUtleSIsImlkeEtleXMiLCJnZW5lcmF0ZUlkeEtleXMiLCJpZHhLZXkiLCJzYWRkIiwiaG1zZXQiLCJyZXBseSIsImRlbCIsInNyZW0iLCJsUHVzaCIsInZhbHVlIiwibHB1c2giLCJyUG9wIiwicnBvcCIsInphZGQiLCJzY29yZSIsInpyZW0iLCJzZXRTaW5nbGUiLCJwcmludCIsImdldFNpbmdsZSIsImdldCIsImRlbFNpbmdsZSIsImUiLCJyZWRpc0xvZyIsImVycm9yIiwiaW5kZXgiLCJtb2R1bGUiLCJleHBvcnRzIl0sIm1hcHBpbmdzIjoiOztBQUFBOzs7QUFHQSxJQUFJQSxRQUFRQyxRQUFRLE9BQVIsQ0FBWjtBQUNBLElBQUlDLGdCQUFnQixTQUFoQkEsYUFBZ0IsR0FBVSxDQUU3QixDQUZEO0FBR0FBLGNBQWNDLElBQWQsR0FBbUIsVUFBU0MsTUFBVCxFQUFnQjtBQUNsQyxLQUFJQyxTQUFTTCxNQUFNTSxZQUFOLENBQW1CRixNQUFuQixDQUFiO0FBQ0EsTUFBS0MsTUFBTCxHQUFjQSxNQUFkO0FBQ0FBLFFBQU9FLEVBQVAsQ0FBVSxTQUFWLEVBQXFCLFlBQVc7QUFDL0JDLFVBQVFDLEdBQVIsQ0FBWSxXQUFaO0FBQ0EsRUFGRDtBQUdBSixRQUFPRSxFQUFQLENBQVUsT0FBVixFQUFtQixVQUFVRyxHQUFWLEVBQWU7QUFDakNGLFVBQVFDLEdBQVIsQ0FBWSxXQUFXQyxHQUF2QjtBQUNBLEVBRkQ7QUFHQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLENBaEJEO0FBaUJBOzs7Ozs7O0FBT0FSLGNBQWNTLEdBQWQsR0FBa0IsVUFBU0MsSUFBVCxFQUFlQyxLQUFmLEVBQXNCQyxVQUF0QixFQUFrQ0MsU0FBbEMsRUFBNENDLFFBQTVDLEVBQXFEO0FBQ3RFLEtBQUlDLE1BQU0sS0FBS0MsV0FBTCxDQUFpQk4sSUFBakIsRUFBdUJDLEtBQXZCLEVBQThCQyxVQUE5QixDQUFWO0FBQ0EsS0FBSUssVUFBVSxLQUFLQyxlQUFMLENBQXFCUixJQUFyQixFQUEwQkMsS0FBMUIsRUFBZ0NDLFVBQWhDLEVBQTJDQyxTQUEzQyxDQUFkO0FBQ0EsTUFBSSxJQUFJTSxNQUFSLElBQWtCRixPQUFsQixFQUEwQjtBQUN6QixPQUFLZCxNQUFMLENBQVlpQixJQUFaLENBQWlCRCxNQUFqQixFQUF3QkYsUUFBUUUsTUFBUixDQUF4QjtBQUNBO0FBQ0QsTUFBS2hCLE1BQUwsQ0FBWWtCLEtBQVosQ0FBa0JOLEdBQWxCLEVBQXNCTCxJQUF0QixFQUEyQixVQUFTRixHQUFULEVBQWNjLEtBQWQsRUFBcUI7QUFDL0MsTUFBRyxPQUFPUixRQUFQLEtBQW1CLFVBQXRCLEVBQWlDO0FBQ2hDQSxZQUFTTixHQUFULEVBQWNjLEtBQWQ7QUFDQTtBQUNELEVBSkQ7QUFLQSxDQVhEO0FBWUF0QixjQUFjdUIsR0FBZCxHQUFrQixVQUFTYixJQUFULEVBQWVDLEtBQWYsRUFBc0JDLFVBQXRCLEVBQWtDQyxTQUFsQyxFQUE0Q0MsUUFBNUMsRUFBcUQ7QUFDdEUsS0FBSUMsTUFBTSxLQUFLQyxXQUFMLENBQWlCTixJQUFqQixFQUF1QkMsS0FBdkIsRUFBOEJDLFVBQTlCLENBQVY7QUFDQSxLQUFJSyxVQUFVLEtBQUtDLGVBQUwsQ0FBcUJSLElBQXJCLEVBQTBCQyxLQUExQixFQUFnQ0MsVUFBaEMsRUFBMkNDLFNBQTNDLENBQWQ7QUFDQSxNQUFJLElBQUlNLE1BQVIsSUFBa0JGLE9BQWxCLEVBQTBCO0FBQ3pCLE9BQUtkLE1BQUwsQ0FBWXFCLElBQVosQ0FBaUJMLE1BQWpCLEVBQXdCRixRQUFRRSxNQUFSLENBQXhCO0FBQ0E7QUFDRCxNQUFLaEIsTUFBTCxDQUFZb0IsR0FBWixDQUFnQlIsR0FBaEIsRUFBb0IsVUFBU1AsR0FBVCxFQUFjYyxLQUFkLEVBQXFCO0FBQ3hDLE1BQUcsT0FBT1IsUUFBUCxLQUFtQixVQUF0QixFQUFpQztBQUNoQ0EsWUFBU04sR0FBVCxFQUFjYyxLQUFkO0FBQ0E7QUFDRCxFQUpEO0FBS0EsQ0FYRDtBQVlBdEIsY0FBY3lCLEtBQWQsR0FBb0IsVUFBU1YsR0FBVCxFQUFhVyxLQUFiLEVBQW1CWixRQUFuQixFQUE0QjtBQUMvQyxNQUFLWCxNQUFMLENBQVl3QixLQUFaLENBQWtCWixHQUFsQixFQUFzQlcsS0FBdEIsRUFBNEIsVUFBU2xCLEdBQVQsRUFBY2MsS0FBZCxFQUFxQjtBQUNoRCxNQUFHLE9BQU9SLFFBQVAsS0FBbUIsVUFBdEIsRUFBaUM7QUFDaENBLFlBQVNOLEdBQVQsRUFBY2MsS0FBZDtBQUNBO0FBQ0QsRUFKRDtBQUtBLENBTkQ7QUFPQXRCLGNBQWM0QixJQUFkLEdBQW1CLFVBQVNiLEdBQVQsRUFBYUQsUUFBYixFQUFzQjtBQUN4QyxNQUFLWCxNQUFMLENBQVkwQixJQUFaLENBQWlCZCxHQUFqQixFQUFxQixVQUFTUCxHQUFULEVBQWNjLEtBQWQsRUFBcUI7QUFDekMsTUFBRyxPQUFPUixRQUFQLEtBQW1CLFVBQXRCLEVBQWlDO0FBQ2hDQSxZQUFTTixHQUFULEVBQWNjLEtBQWQ7QUFDQTtBQUNELEVBSkQ7QUFLQSxDQU5EO0FBT0F0QixjQUFjOEIsSUFBZCxHQUFtQixVQUFTZixHQUFULEVBQWFnQixLQUFiLEVBQW1CTCxLQUFuQixFQUF5QlosUUFBekIsRUFBa0M7QUFDcEQsTUFBS1gsTUFBTCxDQUFZMkIsSUFBWixDQUFpQmYsR0FBakIsRUFBcUJnQixLQUFyQixFQUEyQkwsS0FBM0IsRUFBaUMsVUFBU2xCLEdBQVQsRUFBY2MsS0FBZCxFQUFxQjtBQUNyRCxNQUFHLE9BQU9SLFFBQVAsS0FBbUIsVUFBdEIsRUFBaUM7QUFDaENBLFlBQVNOLEdBQVQsRUFBY2MsS0FBZDtBQUNBO0FBQ0QsRUFKRDtBQUtBLENBTkQ7QUFPQXRCLGNBQWNnQyxJQUFkLEdBQW1CLFVBQVNqQixHQUFULEVBQWFXLEtBQWIsRUFBbUJaLFFBQW5CLEVBQTRCO0FBQzlDLE1BQUtYLE1BQUwsQ0FBWTZCLElBQVosQ0FBaUJqQixHQUFqQixFQUFxQlcsS0FBckIsRUFBMkIsVUFBU2xCLEdBQVQsRUFBY2MsS0FBZCxFQUFxQjtBQUMvQyxNQUFHLE9BQU9SLFFBQVAsS0FBbUIsVUFBdEIsRUFBaUM7QUFDaENBLFlBQVNOLEdBQVQsRUFBY2MsS0FBZDtBQUNBO0FBQ0QsRUFKRDtBQUtBLENBTkQ7QUFPQXRCLGNBQWNpQyxTQUFkLEdBQXdCLFVBQVNsQixHQUFULEVBQWFXLEtBQWIsRUFBbUI7QUFDMUMsTUFBS3ZCLE1BQUwsQ0FBWU0sR0FBWixDQUFnQk0sR0FBaEIsRUFBcUJXLEtBQXJCLEVBQTRCNUIsTUFBTW9DLEtBQWxDO0FBQ0EsQ0FGRDtBQUdBbEMsY0FBY21DLFNBQWQsR0FBd0IsVUFBU3BCLEdBQVQsRUFBYTtBQUNwQyxNQUFLWixNQUFMLENBQVlpQyxHQUFaLENBQWdCckIsR0FBaEIsRUFBcUIsVUFBU1AsR0FBVCxFQUFjYyxLQUFkLEVBQXFCO0FBQ3pDLE1BQUlkLEdBQUosRUFBUztBQUNSRixXQUFRQyxHQUFSLENBQVlDLEdBQVo7QUFDQSxTQUFNQSxHQUFOO0FBQ0E7QUFDREYsVUFBUUMsR0FBUixDQUFZLGtCQUFrQmUsS0FBOUI7QUFDQSxFQU5EO0FBT0EsQ0FSRDs7QUFVQXRCLGNBQWNxQyxTQUFkLEdBQXdCLFVBQVN0QixHQUFULEVBQWE7QUFDcEMsTUFBS1osTUFBTCxDQUFZb0IsR0FBWixDQUFnQlIsR0FBaEI7QUFDQSxDQUZEOztBQUlBZixjQUFjZ0IsV0FBZCxHQUEwQixVQUFVTixJQUFWLEVBQWVDLEtBQWYsRUFBcUJDLFVBQXJCLEVBQWdDO0FBQ3pELEtBQUc7QUFDRixTQUFPRCxRQUFNLEdBQU4sR0FBVUMsVUFBVixHQUFxQixHQUFyQixHQUF5QkYsS0FBS0UsVUFBTCxDQUFoQztBQUNBLEVBRkQsQ0FHQSxPQUFPMEIsQ0FBUCxFQUFVO0FBQ1Q7QUFDQUMsV0FBU0MsS0FBVCxDQUFlRixDQUFmO0FBQ0EsU0FBTyxFQUFQO0FBQ0E7QUFDRCxDQVREO0FBVUF0QyxjQUFja0IsZUFBZCxHQUE4QixVQUFVUixJQUFWLEVBQWVDLEtBQWYsRUFBcUJDLFVBQXJCLEVBQWdDQyxTQUFoQyxFQUEwQztBQUN2RSxLQUFJSSxVQUFVLEVBQWQ7QUFDQSxNQUFNLElBQUl3QixLQUFWLElBQW1CNUIsU0FBbkIsRUFBOEI7QUFDN0IsTUFBRztBQUNGLE9BQUlNLFNBQVMsUUFBTVIsS0FBTixHQUFZLEdBQVosR0FBZ0JFLFVBQVU0QixLQUFWLENBQWhCLEdBQWlDLEdBQWpDLEdBQXFDL0IsS0FBS0csVUFBVTRCLEtBQVYsQ0FBTCxDQUFsRDtBQUNBeEIsV0FBUUUsTUFBUixJQUFnQlIsUUFBTSxHQUFOLEdBQVVDLFVBQVYsR0FBcUIsR0FBckIsR0FBeUJGLEtBQUtFLFVBQUwsQ0FBekM7QUFDQU4sV0FBUUMsR0FBUixDQUFZWSxNQUFaO0FBQ0EsR0FKRCxDQUtBLE9BQU9tQixDQUFQLEVBQVU7QUFDVDtBQUNBQyxZQUFTQyxLQUFULENBQWVGLENBQWY7QUFDQTtBQUNEO0FBQ0QsUUFBT3JCLE9BQVA7QUFDQSxDQWREO0FBZUF5QixPQUFPQyxPQUFQLEdBQWlCM0MsYUFBakIiLCJmaWxlIjoiUmVkaXNQcm92aWRlci5qcyIsInNvdXJjZXNDb250ZW50IjpbIi8qKlxuICogaHR0cDovL3VzZWpzZG9jLm9yZy9cbiAqL1xudmFyIHJlZGlzID0gcmVxdWlyZShcInJlZGlzXCIpO1xudmFyIFJlZGlzUHJvdmlkZXIgPSBmdW5jdGlvbigpe1xuXHRcbn1cblJlZGlzUHJvdmlkZXIuaW5pdD1mdW5jdGlvbihjb25maWcpe1xuXHR2YXIgY2xpZW50ID0gcmVkaXMuY3JlYXRlQ2xpZW50KGNvbmZpZyk7XG5cdHRoaXMuY2xpZW50ID0gY2xpZW50O1xuXHRjbGllbnQub24oJ2Nvbm5lY3QnLCBmdW5jdGlvbigpIHtcblx0XHRjb25zb2xlLmxvZygnY29ubmVjdGVkJyk7XG5cdH0pO1xuXHRjbGllbnQub24oXCJlcnJvclwiLCBmdW5jdGlvbiAoZXJyKSB7XG5cdFx0Y29uc29sZS5sb2coXCJFcnJvciBcIiArIGVycik7XG5cdH0pO1xuXHQvLyB0aGlzLmNsaWVudC5nZXQoJ3N0YWZmXzEnLCBmdW5jdGlvbihlcnIsIHJlcGx5KSB7XG5cdC8vIFx0aWYgKGVycikge1xuXHQvLyBcdFx0Y29uc29sZS5sb2coZXJyKTtcblx0Ly8gXHRcdHRocm93IGVycjtcblx0Ly8gXHR9XG5cdC8vIFx0Y29uc29sZS5sb2coJ0dFVCByZXN1bHQgLT4nICsgcmVwbHkpO1xuXHQvLyB9KTtcdFxufVxuLyoqXG4gKiBAcGFyYW0gXG4gKiBvYmpFOiBlbnRpdHlcbiAqIGFsaWFzOiB0w6puIGFsaWFzIGPhu6dhIGVudGl0eVxuICogdMOqbiBwcm9wZXJ0eSBraMOzYSBjaMOtbmggb2JqRVxuICogYXJyYXkgcHJvcGVydHkgaW5kZXggIFxuICovXG5SZWRpc1Byb3ZpZGVyLnNldD1mdW5jdGlvbihvYmpFLCBhbGlhcywgcHJpbWFyeUtleSwgaW5kZXhLZXlzLGNhbGxiYWNrKXtcblx0dmFyIGtleSA9IHRoaXMuZ2VuZXJhdGVLZXkob2JqRSwgYWxpYXMsIHByaW1hcnlLZXkpO1xuXHR2YXIgaWR4S2V5cyA9IHRoaXMuZ2VuZXJhdGVJZHhLZXlzKG9iakUsYWxpYXMscHJpbWFyeUtleSxpbmRleEtleXMpO1xuXHRmb3IodmFyIGlkeEtleSBpbiBpZHhLZXlzKXtcblx0XHR0aGlzLmNsaWVudC5zYWRkKGlkeEtleSxpZHhLZXlzW2lkeEtleV0pO1xuXHR9XG5cdHRoaXMuY2xpZW50Lmhtc2V0KGtleSxvYmpFLGZ1bmN0aW9uKGVyciwgcmVwbHkpIHtcblx0XHRpZih0eXBlb2YgY2FsbGJhY2sgPT09J2Z1bmN0aW9uJyl7XG5cdFx0XHRjYWxsYmFjayhlcnIsIHJlcGx5KTtcdFx0XHRcblx0XHR9XG5cdH0pO1xufVxuUmVkaXNQcm92aWRlci5kZWw9ZnVuY3Rpb24ob2JqRSwgYWxpYXMsIHByaW1hcnlLZXksIGluZGV4S2V5cyxjYWxsYmFjayl7XG5cdHZhciBrZXkgPSB0aGlzLmdlbmVyYXRlS2V5KG9iakUsIGFsaWFzLCBwcmltYXJ5S2V5KTtcblx0dmFyIGlkeEtleXMgPSB0aGlzLmdlbmVyYXRlSWR4S2V5cyhvYmpFLGFsaWFzLHByaW1hcnlLZXksaW5kZXhLZXlzKTtcblx0Zm9yKHZhciBpZHhLZXkgaW4gaWR4S2V5cyl7XG5cdFx0dGhpcy5jbGllbnQuc3JlbShpZHhLZXksaWR4S2V5c1tpZHhLZXldKTtcblx0fVxuXHR0aGlzLmNsaWVudC5kZWwoa2V5LGZ1bmN0aW9uKGVyciwgcmVwbHkpIHtcblx0XHRpZih0eXBlb2YgY2FsbGJhY2sgPT09J2Z1bmN0aW9uJyl7XG5cdFx0XHRjYWxsYmFjayhlcnIsIHJlcGx5KTtcdFx0XHRcblx0XHR9XG5cdH0pXG59XG5SZWRpc1Byb3ZpZGVyLmxQdXNoPWZ1bmN0aW9uKGtleSx2YWx1ZSxjYWxsYmFjayl7XG5cdHRoaXMuY2xpZW50LmxwdXNoKGtleSx2YWx1ZSxmdW5jdGlvbihlcnIsIHJlcGx5KSB7XG5cdFx0aWYodHlwZW9mIGNhbGxiYWNrID09PSdmdW5jdGlvbicpe1xuXHRcdFx0Y2FsbGJhY2soZXJyLCByZXBseSk7XHRcdFx0XG5cdFx0fVxuXHR9KVxufVxuUmVkaXNQcm92aWRlci5yUG9wPWZ1bmN0aW9uKGtleSxjYWxsYmFjayl7XG5cdHRoaXMuY2xpZW50LnJwb3Aoa2V5LGZ1bmN0aW9uKGVyciwgcmVwbHkpIHtcblx0XHRpZih0eXBlb2YgY2FsbGJhY2sgPT09J2Z1bmN0aW9uJyl7XG5cdFx0XHRjYWxsYmFjayhlcnIsIHJlcGx5KTtcdFx0XHRcblx0XHR9XG5cdH0pXG59XG5SZWRpc1Byb3ZpZGVyLnphZGQ9ZnVuY3Rpb24oa2V5LHNjb3JlLHZhbHVlLGNhbGxiYWNrKXtcblx0dGhpcy5jbGllbnQuemFkZChrZXksc2NvcmUsdmFsdWUsZnVuY3Rpb24oZXJyLCByZXBseSkge1xuXHRcdGlmKHR5cGVvZiBjYWxsYmFjayA9PT0nZnVuY3Rpb24nKXtcblx0XHRcdGNhbGxiYWNrKGVyciwgcmVwbHkpO1x0XHRcdFxuXHRcdH1cblx0fSlcbn1cblJlZGlzUHJvdmlkZXIuenJlbT1mdW5jdGlvbihrZXksdmFsdWUsY2FsbGJhY2spe1xuXHR0aGlzLmNsaWVudC56cmVtKGtleSx2YWx1ZSxmdW5jdGlvbihlcnIsIHJlcGx5KSB7XG5cdFx0aWYodHlwZW9mIGNhbGxiYWNrID09PSdGdW5jdGlvbicpe1xuXHRcdFx0Y2FsbGJhY2soZXJyLCByZXBseSk7XHRcdFx0XG5cdFx0fVxuXHR9KVxufVxuUmVkaXNQcm92aWRlci5zZXRTaW5nbGU9ZnVuY3Rpb24oa2V5LHZhbHVlKXtcblx0dGhpcy5jbGllbnQuc2V0KGtleSwgdmFsdWUsIHJlZGlzLnByaW50KTtcbn1cblJlZGlzUHJvdmlkZXIuZ2V0U2luZ2xlPWZ1bmN0aW9uKGtleSl7XG5cdHRoaXMuY2xpZW50LmdldChrZXksIGZ1bmN0aW9uKGVyciwgcmVwbHkpIHtcblx0XHRpZiAoZXJyKSB7XG5cdFx0XHRjb25zb2xlLmxvZyhlcnIpO1xuXHRcdFx0dGhyb3cgZXJyO1xuXHRcdH1cblx0XHRjb25zb2xlLmxvZygnR0VUIHJlc3VsdCAtPicgKyByZXBseSk7XG5cdH0pO1xufVxuXG5SZWRpc1Byb3ZpZGVyLmRlbFNpbmdsZT1mdW5jdGlvbihrZXkpe1xuXHR0aGlzLmNsaWVudC5kZWwoa2V5KTtcbn1cblxuUmVkaXNQcm92aWRlci5nZW5lcmF0ZUtleT1mdW5jdGlvbiAob2JqRSxhbGlhcyxwcmltYXJ5S2V5KXtcblx0dHJ5e1xuXHRcdHJldHVybiBhbGlhcytcIl9cIitwcmltYXJ5S2V5K1wiOlwiK29iakVbcHJpbWFyeUtleV07XG5cdH1cblx0Y2F0Y2ggKGUpIHtcblx0XHQvLyBUT0RPOiBoYW5kbGUgZXhjZXB0aW9uXG5cdFx0cmVkaXNMb2cuZXJyb3IoZSk7XG5cdFx0cmV0dXJuIFwiXCI7XG5cdH1cbn1cblJlZGlzUHJvdmlkZXIuZ2VuZXJhdGVJZHhLZXlzPWZ1bmN0aW9uIChvYmpFLGFsaWFzLHByaW1hcnlLZXksaW5kZXhLZXlzKXtcblx0dmFyIGlkeEtleXMgPSB7fTtcblx0Zm9yICggdmFyIGluZGV4IGluIGluZGV4S2V5cykge1xuXHRcdHRyeXtcblx0XHRcdHZhciBpZHhLZXkgPSBcIklYX1wiK2FsaWFzK1wiX1wiK2luZGV4S2V5c1tpbmRleF0rXCI6XCIrb2JqRVtpbmRleEtleXNbaW5kZXhdXTtcblx0XHRcdGlkeEtleXNbaWR4S2V5XT1hbGlhcytcIl9cIitwcmltYXJ5S2V5K1wiOlwiK29iakVbcHJpbWFyeUtleV07XG5cdFx0XHRjb25zb2xlLmxvZyhpZHhLZXkpO1xuXHRcdH1cblx0XHRjYXRjaCAoZSkge1xuXHRcdFx0Ly8gVE9ETzogaGFuZGxlIGV4Y2VwdGlvblxuXHRcdFx0cmVkaXNMb2cuZXJyb3IoZSk7XG5cdFx0fVxuXHR9XG5cdHJldHVybiBpZHhLZXlzO1xufVxubW9kdWxlLmV4cG9ydHMgPSBSZWRpc1Byb3ZpZGVyO1xuIl19